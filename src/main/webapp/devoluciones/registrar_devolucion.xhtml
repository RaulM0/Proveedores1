<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>
        <title>Realizar Devoluci贸n</title>
        <h:outputStylesheet name="css/devolucion.css" />
    </h:head>

    <h:body>
        <div class="container">
            <div class="header">
                <h1>Realizar devoluci贸n</h1>
            </div>

            <h:form id="devolucionForm">
                <div class="content">
                    <div class="devolucion-id">
                        <div>
                            <span class="label-id">ID Devoluci贸n:</span>
                            <span class="value-id">#{DevolucionBean.devolucionId}</span>
                        </div>
                    </div>

                    <div class="form-layout">
                        <div class="left-column">
                            
                            <div class="form-group">
                                <h:outputLabel value="Folio Venta:" for="ventaId" styleClass="form-label"/>
                                
                                <div class="input-with-button">
                                    <h:inputText id="ventaId"
                                                 value="#{DevolucionBean.folioVentaBusqueda}"
                                                 styleClass="form-input"
                                                 required="true"
                                                 requiredMessage="Folio Venta es requerido"/>
                                    
                                    <h:commandButton value="Buscar" styleClass="btn-buscar">
                                        <f:ajax execute="ventaId" 
                                                render="product-list-container sale-details-panel messages"
                                                listener="#{DevolucionBean.buscarVenta}" />
                                    </h:commandButton>
                                </div>
                            </div>

                            <h:panelGroup id="sale-details-panel" layout="block">
                                <div class="sale-details" rendered="#{not empty DevolucionBean.ventaEncontrada}">
                                    <div>
                                        <span>Fecha:</span>
                                        <h:outputText value="#{DevolucionBean.ventaEncontrada.fecha_venta}">
                                            <f:convertDateTime pattern="dd/MM/yyyy"/>
                                        </h:outputText>
                                    </div>
                                    <div>
                                        <span>Total Venta:</span>
                                        <h:outputText value="#{DevolucionBean.ventaEncontrada.total}">
                                            <f:convertNumber type="currency" currencySymbol="$"/>
                                        </h:outputText>
                                    </div>
                                    <div>
                                        <span>Estado:</span>
                                        <h:outputText value="#{DevolucionBean.ventaEncontrada.status}" />
                                    </div>
                                </div>
                            </h:panelGroup>

                            <div class="form-group productos-group">
                                <h:outputLabel value="Producto(s) a Devolver:" styleClass="form-label"/>

                                <h:panelGroup id="product-list-container" layout="block" styleClass="productos-list">
                                    <h:selectManyCheckbox value="#{DevolucionBean.productosSeleccionados}"
                                                          layout="pageDirection"
                                                          styleClass="checkbox-list">
                                        <f:selectItems value="#{DevolucionBean.productosDeVenta}"
                                                       var="prod"
                                                       itemValue="#{prod.producto_id}"
                                                       itemLabel="#{prod.nombre} (Cant: #{prod.cantidad}, P/U: $#{prod.precio_unitario})"/>
                                    </h:selectManyCheckbox>
                                </h:panelGroup>
                            </div>
                        </div>

                        <div class="right-column">
                            <div class="form-group">
                                <h:outputLabel value="Fecha Devoluci贸n:" styleClass="form-label"/>
                                <h:outputText value="#{DevolucionBean.fecha}" styleClass="fecha-value">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </div>

                            <div class="form-group motivo-group">
                                <h:outputLabel value="Motivo:" for="motivo" styleClass="form-label"/>
                                <h:inputTextarea id="motivo"
                                                 value="#{DevolucionBean.motivo}"
                                                 rows="5"
                                                 cols="40"
                                                 styleClass="form-textarea"
                                                 required="true"
                                                 requiredMessage="Motivo es requerido"/>
                            </div>

                            <div class="form-group">
                                <h:outputLabel value="Estado:" for="estado" styleClass="form-label"/>
                                <h:selectOneMenu id="estado"
                                                 value="#{DevolucionBean.estado}"
                                                 styleClass="form-select"
                                                 required="true"
                                                 requiredMessage="Estado es requerido">
                                    <f:selectItem itemLabel="Seleccione..." itemValue=""/>
                                    <f:selectItem itemLabel="Pendiente" itemValue="Pendiente"/>
                                    <f:selectItem itemLabel="Aprobada" itemValue="Aprobada"/>
                                    <f:selectItem itemLabel="Rechazada" itemValue="Rechazada"/>
                                    <f:selectItem itemLabel="Procesada" itemValue="Procesada"/>
                                </h:selectOneMenu>
                            </div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <h:commandButton value="Cancelar"
                                         action="#{DevolucionBean.cancelar}"
                                         styleClass="btn-cancelar"
                                         immediate="true"/>

                        <h:commandButton value="Realizar Devolucion"
                                         action="#{DevolucionBean.realizarDevolucion}"
                                         styleClass="btn-realizar"/>
                    </div>

                    <h:messages id="messages" styleClass="messages"
                                errorClass="error-message"
                                infoClass="info-message"
                                globalOnly="false"/>
                </div>
            </h:form>
        </div>
    </h:body>
</html>