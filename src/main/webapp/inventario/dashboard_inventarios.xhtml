<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<h:head>
    <title>Dashboard Inventario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <h:outputStylesheet library="css" name="estilos.css" />
    <h:outputStylesheet library="css" name="dashboardInventarios.css" />
</h:head>

<h:body>
    <f:metadata>
        <f:event type="preRenderView" listener="#{inventarioBean.onPreRenderView}" />
    </f:metadata>
    <!-- Barra de Navegaci贸n Superior Unificada -->
    <div class="navbar">
        <div class="navbar-brand">
            <span class="brand-icon"></span>
            <span class="brand-name">Sistema de Gesti贸n Proveedores</span>
            <a href="../dashboard.xhtml" class="btn-volver">Inicio</a>
        </div>
        <div class="navbar-menu">
            <div class="user-menu">
                <span class="user-icon"></span>
                <span class="user-name">#{sessionBean.nombreUsuario}</span>
                <div class="dropdown-menu">
                    <h:form>
                        <h:commandLink action="#{sessionBean.miCuenta}" styleClass="dropdown-item">
                            <span class="dropdown-icon">锔</span> Mi Cuenta
                        </h:commandLink>
                        <h:commandLink action="#{sessionBean.configuracion}" styleClass="dropdown-item">
                            <span class="dropdown-icon"></span> Configuraci贸n
                        </h:commandLink>
                        <div class="dropdown-divider"></div>
                        <h:commandLink action="#{sessionBean.logout}" styleClass="dropdown-item logout">
                            <span class="dropdown-icon"></span> Cerrar Sesi贸n
                        </h:commandLink>
                    </h:form>
                </div>
            </div>
        </div>
    </div>

    <main class="dashboard-container">
        <h:messages globalOnly="false" layout="table" styleClass="messages-container" errorClass="message-error"
            infoClass="message-info" />
        <div class="card-container">
            <div class="card">
                <p>#{inventarioBean.inventarios.size()}</p>
                <h2>Total de Productos</h2>
            </div>
            <div class="card">
                <p>#{inventarioBean.unidadesTotales}</p>
                <h2>Unidades Totales</h2>
            </div>
            <div class="card">
                <p>#{inventarioBean.productosStockMinimo}</p>
                <h2>Productos con Stock Minimo</h2>
            </div>
            <div class="card">
                <p>#{inventarioBean.productosSinStock}</p>
                <h2>Productos sin Stock</h2>
            </div>
        </div>

        <div class="table-container">
            <h:form id="controlForm">
                <div class="table-controls">
                    <div class="search-bar">
                        <h:selectOneMenu value="#{inventarioBean.filtroBusqueda}" styleClass="form-input">
                            <f:selectItem itemLabel="Producto" itemValue="producto" />
                            <f:selectItem itemLabel="Ubicaci贸n" itemValue="ubicacion" />
                            <f:selectItem itemLabel="ID Inventario" itemValue="id" />
                        </h:selectOneMenu>
                        <h:inputText value="#{inventarioBean.terminoBusqueda}"
                            placeholder="Escribe para buscar por el filtro seleccionado..." styleClass="form-input" />
                        <h:commandButton value="Buscar" action="#{inventarioBean.buscar}" styleClass="action-btn" />
                    </div>
                    <div class="action-buttons">
                        <div>
                            <h:link value="Agregar Inventario" outcome="crear_inventario.xhtml"
                                styleClass="details-btn" />
                        </div>
                    </div>
                </div>
            </h:form>

            <h:form id="tableForm">
                <table>
                    <thead>
                        <tr>
                            <th>Identificador</th>
                            <th>Producto</th>
                            <th>Stock Actual</th>
                            <th>Stock M铆nimo</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ui:repeat value="#{inventarioBean.inventariosFiltrados}" var="inv">
                            <tr>
                                <td>#{inv.id}</td>
                                <td>#{inventarioBean.nombreProductoDisplay(inv.productoId)}</td>
                                <td>#{inv.stock}</td>
                                <td>#{inv.minimo}</td>
                                <td>
                                    <span class="status #{inventarioBean.estadoClass(inv)}">
                                        #{inventarioBean.estadoLabel(inv)}
                                    </span>
                                </td>
                                <td>
                                    <h:commandLink value="Ver Detalles" action="#{inventarioBean.verDetalles(inv.id)}"
                                        styleClass="details-btn">
                                        <f:param name="id" value="#{inv.id}" />
                                    </h:commandLink>
                                </td>
                            </tr>
                        </ui:repeat>
                    </tbody>
                </table>
            </h:form>
        </div>
    </main>
</h:body>

</html>